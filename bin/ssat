#!/usr/bin/env python3
import os
import shlex
import sys

from ssat import cfg, die
<<<<<<< HEAD:bin/ssat
from ssat import fit

rc = {'fit': fit.main}
=======

rc = {}
>>>>>>> 949afb8d030501ec029d5634fa4399a68a667bf2:bin/ssat


def usage():
    die('usage: ssat cfgfile command...')


if __name__ == '__main__':
    if len(sys.argv) < 3:
        usage()

    with open(sys.argv.pop(1)) as f:
        for tok in shlex.split(f.read(), comments=True):
            key, val = tuple(tok.split('=', 2))
            if key not in cfg.keys():
                die('invalid config file.')
            try:
                cfg[key] = type(cfg[key])(val)
            except ValueError:
                die('invalid config file.')
    ret = 1
    while len(sys.argv) > 1:
        cmd = sys.argv.pop(1)
        sys.argv[0] = cmd
        if cmd not in rc.keys():
            usage()
        ret = rc[cmd]()
        if ret == 1:
<<<<<<< HEAD:bin/ssat
            ret = 0
            break
        elif ret < 0:
            die(cmd + ' returned non-zero exit status.')
    sys.exit(ret)
=======
            break
        elif ret < 0:
            die(cmd + ' non-zero exit status.')
    sys.exit(0)
>>>>>>> 949afb8d030501ec029d5634fa4399a68a667bf2:bin/ssat
